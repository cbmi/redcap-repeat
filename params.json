{"name":"Redcap preprocess","tagline":"Preprocess script for RedCap data dictionaries to support custom types and repeating fields","body":"REDCap&trade; Repeat Script\r\n=================\r\n\r\nThis is a script for REDCap&trade; data dictionaries written by CBMi to support repeating fields and groups of fields. It also features custom convenience datatypes for things like \"minimum and maximum\" and \"checkbox with other\".  \r\n\r\nREDCap&trade; is a great tool. It allows anyone to quickly and easily create and share case report forms and surveys. But sometimes to capture common concepts, or multiple instances of a single concept, you need to create groups of fields with complex branching logic over and over. This script helps solve this problem.  It allows you to annotate an existing REDCap&trade; data dictionary with special directives (for example, \"this field can repeat 3 times\") and produces a data dictionary that just works. \r\n\r\n## How it works\r\n1. Create your data dictionary in Excel as usual, using the commands and types described below where convenient.\r\n1. Run the dictionary through the Repeat script.\r\n1. Upload the dictionary created by the script to REDCap&trade;.\r\n\r\nIf you need to make a change to the dictionary, you make it to your original data dictionary and repeat steps 2 and 3.\r\n\r\n# Features\r\n\r\n## Repeating fields\r\n\r\nREDCap&trade; does not support the ability to specify that a given field repeats a variable number of times. For example, specifying a list of medications requires creating a number of medicine fields and various complex branching schemes. This script can help.\r\n\r\n### The Basics\r\n\r\nTo specify that a field should repeat, use the following in the field name column:\r\n\r\n\\<field\\_name\\> repeat \\<maximum number of times field repeats\\> \\<Name of Repeat\\>\r\n\r\nThe \\<Name of Repeat\\> attribute will be used to construct a question asking the user how many times the field repeats. For example\r\n\r\nField Name                              |  Field Type      |  Field Label                 | Branching Logic\r\n----------------------------------------|------------------|------------------------------|-----------------\r\nmedication repeat 3 Patient Medication  | text             | Patient medication           |\r\n\r\nwill become:\r\n\r\nField Name  |  Field Type      |  Field Label                                          | Text Validation Type | Text Validation Min        | Text Validation Max| Branching Logic\r\n------------|------------------|-------------------------------------------------------|----------------------|----------------------------|--------------------|----------------\r\nmedication\\_group\\_no | text     | How many patient medications would you like to enter? |      number          | 0                          |   3                |\r\nmedication1         | text     | Patient medication 1                                  |                      |                            |                    | [medication\\_group\\_no] >= 1\r\nmedication2         | text     | Patient medication 2                                  |                      |                            |                    | [medication\\_group\\_no] >= 2\r\nmedication3         | text     | Patient medication 3                                  |                      |                            |                    | [medication\\_group\\_no] >= 3\r\n\r\n### Controlling the Field Label\r\n\r\nBy default, when creating the field label for a repeated field, the preprocess script looks for the \\<Name of Repeat\\> in the Field Label and puts a number after it. If that behavior is not what you want, you can control where the number goes by putting $d in the field label. Use $s if you would like the number to be of the style 1st, 2nd, 10th, etc. For example\r\n\r\nField Name                              |  Field Type      |  Field Label                 | Branching Logic\r\n----------------------------------------|------------------|------------------------------|-----------------\r\nmedication repeat 3 Patient Medication  | text             | $s patient medication        |  \r\n\r\nwill become:\r\n\r\nField Name  |  Field Type      |  Field Label                                          | Text Validation Type | Text Validation Min        | Text Validation Max| Branching Logic\r\n------------|------------------|-------------------------------------------------------|----------------------|----------------------------|--------------------|----------------\r\nmedication\\_group\\_no | text     | How many patient medications would you like to enter? |      number          | 0                          |   3                |\r\nmedication1         | text     | 1st patient medication                                |                      |                            |                    | [medication\\_group\\_no] >= 1\r\nmedication2         | text     | 2nd patient medication                                |                      |                            |                    | [medication\\_group\\_no] >= 2\r\nmedication3         | text     | 3rd Patient medication                                |                      |                            |                    | [medication\\_group\\_no] >= 3\r\n\r\n### Controlling the Field Name\r\n\r\nBy default, the generated Field Names for repeated groups just place a number at the end. If you would like the number to go elsewhere, put ${d} anywhere in the Field Label.\r\n\r\nFor example:\r\n\r\nField Name                 |  Field Type      |  Field Label                 | Branching Logic\r\n---------------------------|------------------|------------------------------|------------------\r\ngene${d}\\_name repeat 4 Gene | text           | Gene $d name                |\r\n\r\nwill become:\r\n\r\nField Name    |  Field Type |  Field Label                         | Text Validation Type | Text Validation Min        | Text Validation Max| Branching Logic\r\n--------------|-------------|--------------------------------------|----------------------|----------------------------|--------------------|----------------\r\ngene\\_group\\_no | text        | How many genes do you want to enter? |      number          | 0                          |   4                |\r\ngene1\\_name    | text        | Gene 1 name                          |                      |                            |                    | [gene\\_group\\_no] >= 1\r\ngene2\\_name    | text        | Gene 2 name                          |                      |                            |                    | [gene\\_group\\_no] >= 2\r\ngene3\\_name    | text        | Gene 3 name                          |                      |                            |                    | [gene\\_group\\_no] >= 3\r\ngene4\\_name    | text        | Gene 4 name                          |                      |                            |                    | [gene\\_group\\_no] >= 4\r\n\r\n\r\n### Repeating groups of fields\r\n\r\nSometimes you want a group of fields to repeat instead of just a single field. For example, you might be trying to capture date and result of a series of hand xrays. To do this, follow the same rules for single field repeats except change \"repeat\" to \"startrepeat\" and terminate the repeating group by putting \"endrepeat\" after the Field Label of the last field in the group.\r\nFor example:\r\n\r\nField Name                      |  Field Type      |  Field Label        | Choices                | Text Validation Type | Branching Logic\r\n--------------------------------|------------------|---------------------|------------------------|----------------------|----------------\r\nxray\\_date startrepeat 3 xray    | text             | $s xray data        |                        |   date               |\r\nxray\\_hand                       | radio            | $s xray hand        | 1, Right &#124; 2, Left|                      |\r\nxray\\_result endrepeat           | notes            | Result of $s xray   |                        |                      |\r\n\r\nwill become:\r\n\r\nField Name    |  Field Type |  Field Label                         | Choices                | Text Validation Type | Text Validation Min        | Text Validation Max| Branching Logic\r\n--------------|-------------|--------------------------------------|------------------------|----------------------|----------------------------|--------------------|----------------\r\nxray\\_group\\_no | text        | How many xrays do you want to enter? |                        |      number          | 0                          |   3                |\r\nxray\\_date1    | text        | 1st xray date                        |                        |      date            |                            |                    | [xray\\_group\\_no] >= 1\r\nxray\\_hand1    | radio       | 1st xray hand                        |1, Right &#124; 2, Left |                      |                            |                    | [xray\\_group\\_no] >= 1\r\nxray\\_result1  | notes       | Result of 1st xray                   |                        |                      |                            |                    | [xray\\_group\\_no] >= 1\r\nxray\\_date2    | text        | 2nd xray date                        |                        |      date            |                            |                    | [xray\\_group\\_no] >= 2\r\nxray\\_hand2    | radio       | 2nd xray hand                        |1, Right &#124; 2, Left |                      |                            |                    | [xray\\_group\\_no] >= 2\r\nxray\\_result2  | notes       | Result of 2nd xray                   |                        |                      |                            |                    | [xray\\_group\\_no] >= 2\r\nxray\\_date3    | text        | 3rd xray date                        |                        |      date            |                            |                    | [xray\\_group\\_no] >= 3\r\nxray\\_hand3    | radio       | 3rd xray hand                        |1, Right &#124; 2, Left |                      |                            |                    | [xray\\_group\\_no] >= 3\r\nxray\\_result3  | notes       | Result of 3rd xray                   |                        |                      |                            |                    | [xray\\_group\\_no] >= 3\r\n\r\n\r\n### Nesting groups of repeating fields\r\n\r\nSometimes a single group of repeating fields may not be enough. For example, you might be trying to capture a list of medications, each with a list of side affects. To accomplish this you can nest startrepeat-endrepeat groups or single repeat fields inside of other startrepeat-endrepeat groups. The behavior should be just as you would expect. The only additional functionality is that you can use $s1 or $d1 in Field Labels to refer to the iteration of outer groups. For example, $s will always refer to the current (innermost) group, and $1 will always refer to the outermost group. If you had 2 nested groups, $1 would refer to the iteration of the outermost group, $2 would refer to the iteration of the middle group, and $s would still refer to the iteration of the innermost group. Examples should clear this up.\r\n\r\nField Name                                         |  Field Type      |  Field Label        | Text Validation Type | Branching Logic\r\n---------------------------------------------------|------------------|---------------------|----------------------|-----------------------|----------------\r\nmedication${d}\\_name startrepeat 3 Medication       | text             | $s medication name               |                       |\r\nsideaffect repeat 3 Side Affect                    | text             | $s side affect of medication $d1 |                       |\r\nmedication${d}\\_date endrepeat                      | text             | Date $s medication taken         | date                  |\r\n\r\nwill become:\r\n\r\nField Name                      |  Field Type |  Field Label                                | Text Validation Type  | Text Validation Min | Text Validation Max| Branching Logic\r\n--------------------------------|-------------|---------------------------------------------|-----------------------|---------------------|--------------------|---------------------------------------------|\r\nmed\\_group\\_no             | text        | How many medications do you want to enter? |  number                | 0                 |   3                |                                      |\r\nmed1\\_name                | text        | 1st medication name                        |                        |                       |                 | [med\\_group\\_no] >= 1               | \r\nmed1\\_sideaffect\\_group\\_no | text        | How many side affects do you want to enter? |  number             | 0                     |   3             | [med\\_group\\_no] >= 1             |\r\nmed1\\_sideaffect1         | text        | 1st side affect for medication 1           |                        |                       |                 | [med1\\_sideaffect\\_group\\_no] >= 1  |\r\nmed1\\_sideaffect2         | text        | 2nd side affect for medication 1           |                        |                       |                 | [med1\\_sideaffect\\_group\\_no] >= 2  |\r\nmed1\\_sideaffect3         | text        | 3rd side affect for medication 1           |                        |                       |                 | [med1\\_sideaffect\\_group\\_no] >= 3  |\r\nmed1\\_date                | text        | Date 1st medication taken                  |  date                  |                       |                 | [med\\_group\\_no] >= 1               |\r\nmed2\\_name                | text        | 2nd medication name                        |                        |                       |                 | [med\\_group\\_no] >= 2               |\r\nmed2\\_sideaffect\\_group\\_no | text        | How many side affects do you want to enter?|  number                | 0                     |   3           | [med\\_group\\_no] >= 2             |\r\nmed2\\_sideaffect1         | text        | 1st side affect for medication 2           |                        |                       |                 | [med2\\_sideaffect\\_group\\_no] >= 1  |\r\nmed2\\_sideaffect2         | text        | 2nd side affect for medication 2           |                        |                       |                 | [med2\\_sideaffect\\_group\\_no] >= 2  |\r\nmed2\\_sideaffect3         | text        | 3rd side affect for medication 2           |                        |                       |                 | [med2\\_sideaffect\\_group\\_no] >= 3  |\r\nmed2\\_date                | text        | Date 2nd medication taken                  | date                   |                       |                 | [med\\_group\\_no] >= 2               |\r\nmed3\\_name                | text        | 3rd medication name                        |                        |                       |                 | [med\\_group\\_no] >= 3               |\r\nmed3\\_sideaffect\\_group\\_no | text        | How many side affects do you want to enter?|  number                | 0                     |   3           | [med\\_group\\_no] >= 3             |\r\nmed3\\_sideaffect1         | text        | 1st side affect for medication 3           |                        |                       |                 | [med3\\_sideaffect\\_group\\_no] >= 1  |\r\nmed3\\_sideaffect2         | text        | 2nd side affect for medication 3           |                        |                       |                 | [med3\\_sideaffect\\_group\\_no] >= 2  |\r\nmed3\\_sideaffect3         | text        | 3rd side affect for medication 3           |                        |                       |                 | [med3\\_sideaffect\\_group\\_no] >= 3  |\r\nmed3\\_date                | text        | Date 3rd medication taken                  |     date               |                       |                 | [med\\_group\\_no] >= 3               |\r\n\r\nIf a nested repeating group or field is actually the last field of its parent group then add a blank row with the following as Field Name (note the leading space):\r\n    \r\n\" endrepeat\"\r\n\r\n\r\nFor example, in the above example, if you wanted the side affects to be the last thing entered for each medication (rather than the date), it would have to look like this:\r\n\r\nField Name                                         |  Field Type      |  Field Label        | Text Validation Type | Branching Logic\r\n---------------------------------------------------|------------------|---------------------|----------------------|-----------------------|----------------\r\nmedication${d}\\_name startrepeat 3 Medication       | text             | $s medication name               |                       |\r\nmedication${d}\\_date                                | text             | Date $s medication taken        | date                  |\r\nsideaffect repeat 3 Side Affect                    | text             | $s side affect of medication $d1 |                       |\r\n&nbsp;endrepeat                                    |                  |                                  |                       |\r\n\r\n### Repeating field prompt modes\r\nBy default, the script will generate a question before each repeating item asking how many you would like to enter and then show that many instances of the field. There are two other modes controlled by flags on the command prompt. Using -a will cause the script to automatically show the first instance of the repeating item, and as the first field in each repeating group of fields is filled in, it will show the next repeating field. Using the -p flag will cause the script to add a checkbox field after each repeating group asking if you would like to enter another.\r\n\r\n### Branching logic details\r\n\r\nThe script will try to preserve any branching logic you put in place ahead of time while inserting any necessary additional logic. The intention is that it should work as one would expect. If a situation is encountered where this is not true, please report it.\r\n\r\n### Custom fields within repeating fields/groups\r\nCustom field types (described below) should work seamlessly with repeating fields and should not require any additional work. If any bugs are encountered, please report them.\r\n\r\n\r\n## Custom Datatypes - Specify commonly used field types in one line\r\nInstead of manually creating multiple RedCap&trade; fields to capture data for what is ultimately a single discrete value, use a custom type, and let this script do all the hard work. Let's see a few examples.\r\n\r\n### Minimum and Maximum\r\n\r\nInstead of creating two RedCap&trade; number fields to capture a range of numbers, just use the minmax field type. Give the script this:\r\n\r\nField Name |  Field Type |  Field Label            |Text Validation Type |\r\n-----------|-------------|-------------------------|---------------------|\r\ntemp       | minmax      | Temperature $placeholder| number              |\r\n\r\nand it will turn it into this:\r\n\r\nField Name  |  Field Type |  Field Label            |  Text Validation Type |\r\n------------|-------------|-------------------------|-----------------------|\r\ntemp\\_minimum| text        |   Temperature minimum  | number                |\r\ntemp\\_maximum| text        |   Temperature maximum  | number                |\r\n\r\nAll other columns will be preserved just as you would expect. \r\n\r\n### Checkbox with Other\r\n\r\nSpecify checkbox\\_other to automatically create a checkbox field followed by a text field to specify further details. The branching logic to only show the details field when the Other choice is selected will be written for you.\r\n\r\n\r\nField Name |  Field Type         |  Field Label            | Choices                               |\r\n-----------|---------------------|-------------------------|---------------------------------------|\r\nrelative   | checkbox\\_other      | Affected relatives      | 1, Mom &#124;  2, Dad &#124; 3, Other | \r\n\r\nwill become:\r\n\r\n\r\nField Name     |  Field Type         |  Field Label            | Choices                               |Branching Logic|\r\n---------------|---------------------|-------------------------|---------------------------------------|---------------|\r\nrelative       | checkbox            | Affected relatives      | 1, Mom &#124;  2, Dad &#124; 3, Other |  \t\t   |\r\nrelative\\_other | text                | Other Affected relatives|                                      |[relative(3)] = '1'|\r\n\r\n#### Controlling the language used in the Field Label for generated fields\r\nThe script tries to use very generic language for generated Field Labels. Placing a pipe in the Field Label field followed by something like this\r\n\r\n\tPlease specify $placeholder relative\r\n\t\r\nwill allow you to control the generated Field Label, producing this\r\n\r\n\tPlease specify other relative\r\n\t\r\nA specific example:\r\n\r\n\t\r\nField Name |  Field Type         |  Field Label            | Choices                               |\r\n-----------|---------------------|-------------------------|---------------------------------------|\r\ntemp       | checkbox\\_other      | Affected relatives &#124; Please specify $placeholder affected relative| 1, Mom &#124;  2, Dad &#124; 3, Other |\r\n\r\nwill become:\r\n\r\nField Name |  Field Type         |  Field Label            | Choices                               |Branching Logic|\r\n-----------|---------------------|-------------------------|---------------------------------------|---------------|\r\ntemp       | checkbox            | Affected relatives      | 1, Mom &#124;  2, Dad &#124; 3, Other |\t\t\t   |\r\ntemp\\_other | text               | Please specify other affected relative|                          |[temp(3)] = '1'|\r\n\r\n### Checkbox with details for each option\r\n\r\nSimilar to checkbox\\_other, the checkbox\\_details type will create textbox fields that will show for each checkbox selected. It works the same way as the checkbox\\_other except for creating additionally conditional fields.\r\n\r\n### Radio/Dropdown other and Radio/Dropdown with details\r\n\r\nThere are equivalent custom types for radio and dropdown (radio\\_other, radio\\_details, dropdown\\_other, and dropdown\\_details) that work exactly the same as the checkbox\\_other and checkbox\\_details types.\r\n\r\n### Age in weeks and days\r\nThe custom type age\\_weeks\\_days will create the two individual week and day fields with the correct range restrictions. This is especially useful for capturing gestational age.\r\n\r\nFor example:\r\n\r\nField Name      |  Field Type    |  Field Label                 | Min Value | Max Value|\r\n----------------|----------------|------------------------------|-----------|----------|\r\ngestational\\_age | age\\_weeks\\_days | Gestational age $placeholder |           |          |\r\n\r\nbecomes:\r\n\r\nField Name            |  Field Type    |  Field Label                 | Min Value | Max Value|\r\n----------------------|----------------|------------------------------|-----------|----------|\r\ngestational\\_age\\_weeks | text           | Gestational age in weeks     | 0         |   52     |\r\ngestational\\_age\\_days  | text           | Gestational age in days      | 0         |   6      |\r\n\r\n### Age in years and months\r\n\r\nThere is a custom field available for age in years and months as well. Specify the type as age\\_years\\_months to use it. It works exactly the same as age\\_weeks\\_days\r\n\r\n### Value with Units\r\n\r\nFor a measurement and value that requires units to be specified, use the value\\_with\\_units custom type.\r\n\r\nField Name            |  Field Type      |  Field Label                 |\r\n----------------------|------------------|------------------------------|\r\npotassium\\_level       | value\\_with\\_units | Potassium level              |\r\n\r\nbecomes:\r\n\r\nField Name                  |  Field Type      |  Field Label                 | Text Validation Type\r\n----------------------------|------------------|------------------------------|---------------------\r\npotassium\\_level            | text             | Potassium level              | number\r\npotassium\\_level\\_units     | text             | Potassium level units        | \r\n\r\n#### Convenience unit types\r\nThere are two convenience unit types that work the same way as value\\_with\\_unit, but instead of a free text input for units, provide a dropdown with specific choices. These are\r\n\r\n* weight\\_value\\_with\\_units\r\n* height\\_value\\_with\\_units\r\n\r\n## Caveats\r\n \r\nThis is beta software. It has been used internally for one complex project but there are sure to be unexpected edge cases. Please make sure to backup any data dictionary files you run through the script. This has not been test on calculated fields used within repeating groups.\r\n\r\n## Usage\r\nThe script is written in python. It has no required external dependencies, but you may want to install the python inflector package which will help properly pluralize repeating item names in generated questions. To install the inflector, issue the following from the command prompt:\r\n\t\r\n\teasy_install inflector\r\n\t\r\nTo execute the script, call it from the command prompt as follows:\r\n\r\n\tpython redcap_repeat.py \"name of input file\" \"name of output file\"\r\n\t\r\nUse the -h flag to see a description of available options.\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}